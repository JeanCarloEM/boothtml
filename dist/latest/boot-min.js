var __awaiter=this&&this.__awaiter||function(t,o,r,e){return new(r||(r=Promise))((function(a,s){function i(t){try{c(e.next(t))}catch(t){s(t)}}function n(t){try{c(e.throw(t))}catch(t){s(t)}}function c(t){var o;t.done?a(t.value):(o=t.value,o instanceof r?o:new r((function(t){t(o)}))).then(i,n)}c((e=e.apply(t,o||[])).next())}))};const LOG=console.log,WARN=console.warn,ERROR=console.error,w=window,$=t=>document.querySelectorAll(t),bootWorkerFile="bootworker",bootSWorkerFile="bootworker";export class bootHTML{baseMessageWorker(t,o,r){t.addEventListener("message",(function(t){if(t.hasOwnProperty("data")&&t.data.hasOwnProperty("cmd")&&["log","warn","error"].indexOf(t.data.cmd.trim().toLowerCase())>=0){let e=t.data.cmd.trim().toLowerCase();return("log"===e?LOG:"warn"===e?WARN:"error"===e?ERROR:()=>r(t))(o+": "+t.data.msg,t.data.more?t.data.more:null)}return r(t)}))}readScriptData(){var t;return LOG("Getting root boot path..."),t=(t,o=!1)=>{try{let r=$("script[data-customcfg]")[0].getAttribute(t)+"";return r=(o?r.replace(/\/[^\/]+$/,""):r).trim(),0==r.length||r.match(/^\s*(http|ftp)s?\:\/\//i)?r:r=w.location.protocol+"//"+w.location.host+"/"+r.replace(/^\s*\//i,"").replace(/\/s*$/i,"")}catch(o){throw ERROR("Failed to get script data: '"+t+"'."),o}},w.bootdata={root:t("src",!0),cfg:{custom:t("data-customcfg"),customroot:t("data-customcfg",!0),more:t("data-morecfg"),moreroot:t("data-morecfg",!0)}},LOG("Boot root is '"+w.bootdata.root+"'"),LOG("Custom CFG is '"+w.bootdata.cfg.custom+"'"),LOG("More CFG is '"+w.bootdata.cfg.more+"'"),w.bootdata}parseworker_start(t){return __awaiter(this,void 0,void 0,(function*(){LOG("Registering ParseWorker from url '"+t+"'."),navigator.serviceWorker.register(t).then((o=>{w.bootworker=o,this.baseMessageWorker(o,"ParserWorker",(t=>{})),LOG("ParseWorker registered from '"+t+"'.")})).catch((t=>{ERROR(t)}))}))}bootworker_start(){return __awaiter(this,void 0,void 0,(function*(){this.readScriptData(),LOG("Initializing BootWorker from url '"+w.bootdata.root+"/bootworker.js'.");var t=!1;(o=>{w.bootworker=o,this.baseMessageWorker(o,"BootWorker",(o=>{(o=>{switch(o.cmd.trim().toLowerCase()){case"load_parserURLworker".toLowerCase():if(t)return;LOG("Getting parserURL.worker for boot."),t=!0,this.parseworker_start(w.bootdata.root+"/parseURL.worker.js");break;default:break}})(o.data)})),o.postMessage({cmd:"start",bootdata:w.bootdata,location:JSON.parse(JSON.stringify(w.location))})})(new Worker(w.bootdata.root+"/bootworker.js"))}))}parse_SEO(){return __awaiter(this,void 0,void 0,(function*(){LOG("Preparing the SEO analyzer...")}))}constructor(){this.parse_SEO(),this.bootworker_start()}}